//
//  MarketData.swift
//  CryptoWallet
//
//  Created by ricardo silva on 11/05/2022.
//

import Foundation

//JSON Data:
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 13436,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 804,
     "total_market_cap": {
       "btc": 46928958.34561714,
       "eth": 611508809.9817947,
       "ltc": 18333581399.742638,
       "bch": 6234985973.550952,
       "bnb": 4772796420.56404,
       "eos": 878497319877.4386,
       "xrp": 2901812049321.8257,
       "xlm": 10077931646734.924,
       "link": 173318289420.35474,
       "dot": 134965151582.03801,
       "yfi": 104522498.86635396,
       "usd": 1491065282994.622,
       "aed": 5476705150418.484,
       "ars": 174352819226455.94,
       "aud": 2127873917251.8098,
       "bdt": 129574786819372.89,
       "bhd": 562130120623.6904,
       "bmd": 1491065282994.622,
       "brl": 7653190778026.504,
       "cad": 1932905202978.002,
       "chf": 1476062184117.1277,
       "clp": 1292529940563888,
       "cny": 10024133684516.248,
       "czk": 35857261683873.09,
       "dkk": 10509286068840.018,
       "eur": 1412970738797.7788,
       "gbp": 1206713169266.412,
       "hkd": 11705086131300.201,
       "huf": 536428628340708.25,
       "idr": 21648352075085348,
       "ils": 5117783370822.448,
       "inr": 115217611458213.03,
       "jpy": 193467957066476.22,
       "krw": 1899363195894426.2,
       "kwd": 457481194801.99457,
       "lkr": 537858829829918,
       "mmk": 2766292948237658.5,
       "mxn": 30192676343536.15,
       "myr": 6525647211025.971,
       "ngn": 621537998009165.8,
       "nok": 14393206953723.3,
       "nzd": 2351022274308.9355,
       "php": 77775448770956,
       "pkr": 282231787583416.6,
       "pln": 6591340565264.109,
       "rub": 101771906411764.39,
       "sar": 5593048501254.71,
       "sek": 14876905549396.186,
       "sgd": 2066668669515.45,
       "thb": 51620681588339.2,
       "try": 22857456728173.59,
       "twd": 44244676864290.664,
       "uah": 45196404450577.445,
       "vef": 149300366786.25116,
       "vnd": 34376145310319496,
       "zar": 23860646941637.65,
       "xdr": 1089250028402.6613,
       "xag": 68366133489.90323,
       "xau": 804280613.6472964,
       "bits": 46928958345617.14,
       "sats": 4692895834561714
     },
     "total_volume": {
       "btc": 5809542.197867074,
       "eth": 75701365.66409646,
       "ltc": 2269594692.373628,
       "bch": 771856341.8707654,
       "bnb": 590845464.8170412,
       "eos": 108753047808.0121,
       "xrp": 359228078890.2003,
       "xlm": 1247591492181.3853,
       "link": 21455833488.444073,
       "dot": 16707929836.900045,
       "yfi": 12939299.937547151,
       "usd": 184585530698.03818,
       "aed": 677985423036.8538,
       "ars": 21583902484121.188,
       "aud": 263418872905.1479,
       "bdt": 16040632870281.492,
       "bhd": 69588560487.6298,
       "bmd": 184585530698.03818,
       "brl": 947422153413.8214,
       "cad": 239282838082.13416,
       "chf": 182728231088.1542,
       "clp": 160007967285594.4,
       "cny": 1240931605776.7715,
       "czk": 4438928162825.462,
       "dkk": 1300990753656.5793,
       "eur": 174917863527.72845,
       "gbp": 149384331651.79907,
       "hkd": 1449024103809.2007,
       "huf": 66406859694987.24,
       "idr": 2679944736217171.5,
       "ils": 633552917014.8773,
       "inr": 14263294973954.086,
       "jpy": 23950249486366.44,
       "krw": 235130525471270.78,
       "kwd": 56633609601.11853,
       "lkr": 66583910628907.93,
       "mmk": 342451573207563.25,
       "mxn": 3737684224578.5317,
       "myr": 807838575099.965,
       "ngn": 76942922969209.69,
       "nok": 1781798405676.7092,
       "nzd": 291043389672.82416,
       "php": 9628164943812.707,
       "pkr": 34938714545289.86,
       "pln": 815971044411.4543,
       "rub": 12598791997516.021,
       "sar": 692388078240.6301,
       "sek": 1841677582664.0908,
       "sgd": 255842006041.05524,
       "thb": 6390351257351.625,
       "try": 2829625120171.605,
       "twd": 5477243184923.487,
       "uah": 5595061729556.145,
       "vef": 18482549188.79452,
       "vnd": 4255574251393181.5,
       "zar": 2953814449810.775,
       "xdr": 134843052714.46895,
       "xag": 8463344412.836299,
       "xau": 99565435.25852145,
       "bits": 5809542197867.074,
       "sats": 580954219786707.4
     },
     "market_cap_percentage": {
       "btc": 40.564449954686125,
       "eth": 19.743130228915483,
       "usdt": 5.57639607405052,
       "bnb": 3.521454733661182,
       "usdc": 3.25350737979429,
       "xrp": 1.665923038344781,
       "sol": 1.4722767080732264,
       "ada": 1.465493302453522,
       "busd": 1.1528522328204107,
       "doge": 0.9521247823367603
     },
     "market_cap_change_percentage_24h_usd": -2.2434930449119745,
     "updated_at": 1652266233
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
